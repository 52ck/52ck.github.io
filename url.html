<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>链接检查与跳转</title>
</head>
<body>
    <script>
        function checkUrl(url) {
            var CHECK_URL_HEAD = "http://mp.weixinbridge.com/mp/wapredirect?url=";
            var CHECK_URL_TAIL = "&action=appmsg_redirect&uin=&biz=MzUxMTMxODc2MQ==&mid=100000007&idx=1&type=1&scene=0";
            var curl = CHECK_URL_HEAD + url + CHECK_URL_TAIL;

            return fetch(curl, {
                method: 'GET',
                headers: {
                    'User-Agent': 'Basic Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36'
                }
            })
            .then(response => response.text())
            .then(data => {
                if (data.includes("已停止访问该网页")) {
                    return "不正常";
                } else {
                    return "正常";
                }
            })
            .catch(error => {
                console.error("发生错误: ", error);
                return "错误";
            });
        }

        var urlArray = [
            "https://y8b.cn",
            "https://chat-1307588305.cos.ap-shanghai.myqcloud.com/dsdfesfsfgswfew.html",
            // 添加更多的链接
        ];

        var results = [];

        function checkUrlsSequentially(index) {
            if (index < urlArray.length) {
                checkUrl(urlArray[index]).then(result => {
                    results.push(result);
                    console.log("结果：" + result);
                    if (result === "正常") {
                        // 如果链接正常，进行定向跳转
                        window.location.href = urlArray[index];
                    } else {
                        // 否则，继续检查下一个链接
                        checkUrlsSequentially(index + 1);
                    }
                });
            } else {
                console.log("检查完成。");
                console.log("所有链接的结果：" + results.join(", "));
                if (!results.includes("正常")) {
                    // 如果没有正常链接，不进行跳转
                    console.log("没有正常链接，不进行跳转。");
                }
            }
        }

        setTimeout(function() {
            checkUrlsSequentially(0);
        }, 100);
    </script>
</body>
</html>
